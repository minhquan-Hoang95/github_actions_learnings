# Workflow CodeQL pour l'analyse de sécurité statique (SAST)
# https://github.com/github/codeql-action

name: "CodeQL Analysis"

on:
  push:
    branches: [main] # Déclenche le workflow sur les pushes vers la branche main
  pull_request:
    branches: [main] # Déclenche le workflow sur les pull requests ciblant la branche main
  schedule:
    - cron: '0 6 * * 1' # Déclenche le workflow tous les dimanches à minuit (UTC)

permissions:
    contents: read # Permission de lecture sur les contenus du dépôt
    actions: read # Permission de lecture sur les actions GitHub


    security-events: write # Permission d'écriture pour les événements de sécurité

jobs:
    analyze:
        name: Analyze code with CodeQL
        runs-on: ubuntu-24.04 # Environnement d'exécution du job

        strategy:
            fail-fast: false # Permet de continuer l'exécution même si une matrice échoue
            matrix: 
                language: [python] # Spécifie les langages à analyser, ici Python
                
        steps:
            # Checkout du code source
            - name: Checkout repository
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6 
            
            # Initialisation de CodeQL for scanning
            - name: Initialize CodeQL
              uses: github/codeql-action/init@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4
              with:
                languages: ${{ matrix.language }} # Utilisation de la matrice pour spécifier les langages à analyser
                # Requete de sécurité étendues
                queries: +security-extended # Ajout de requêtes de sécurité étendues pour une analyse plus approfondie
            
            # Auto-build (CodeQL détecte automatiquement le langage)
            - name: Autobuild
              uses: github/codeql-action/autobuild@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4 

            # Analyse du code avec CodeQL
            - name: Perform CodeQL Analysis
              uses: github/codeql-action/analyze@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4 
              with:
                category: "/language:${{ matrix.language }}" # Catégorie d'analyse basée sur le langage de la matrice